<!DOCTYPE html>
<html>
  <head>
    <title>Form Validation Example</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <script>
      var jsonData = JSON.parse(window.localStorage.getItem("data"));
      window.onload = function () {
        const form = document.querySelector("form");
        const nameInput = document.querySelector("#name");
        const emailInput = document.querySelector("#email");
        const passwordInput = document.querySelector("#password");
        const messageInput = document.querySelector("#message");

        var JsonDataFromLocalStorage = JSON.parse(
          window.localStorage.getItem("data")
        );

        RenderDataintoTable(JsonDataFromLocalStorage);

        form.addEventListener("submit", (event) => {
          console.log("On-SUbmit");
          event.preventDefault(); // prevent the form from submitting

          if (nameInput.value === "") {
            alert("Please enter your name");
            return;
          }
          if (!isValidEmail(emailInput.value)) {
            alert("Please enter a valid email address");
            return;
          }

          if (passwordInput.value.length < 5) {
            alert("Password must be at least 8 characters long");
            return;
          }
          if (!isMessageValid(messageInput.value)) {
            alert("Message must be 5-50 chracters");
            return;
          }
          const message = document.getElementById("After-Submit-message");

          message.innerHTML = "Form submitted!"; // update the message text

          //Adding data into Json Array
          var primaryId =
            jsonData.slice(-1)[0] == undefined
              ? 1
              : jsonData.slice(-1)[0].Id + 1;
          var myObject = {
            Id: primaryId,
            name: nameInput.value,
            email: emailInput.value,
          };
          jsonData.push(myObject);
          localStorage.setItem("data", JSON.stringify(jsonData));
          var JsonDataFromLocalStorage = JSON.parse(
            window.localStorage.getItem("data")
          );

          RenderDataintoTable(JsonDataFromLocalStorage);
          form.reset();
        });

        function isValidEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
        }
        function isMessageValid(message) {
          const messageRegex = /^.{5,100}$/;
          return messageRegex.test(message);
        }
      };

      function RenderDataintoTable(JsonDataFromLocalStorage) {
        var tbody = document.getElementById("tablebody");
        tbody.innerHTML = "";
        for (var i = 0; i < JsonDataFromLocalStorage.length; i++) {
          var item = JsonDataFromLocalStorage[i];
          var row = document.createElement("tr");
          row.innerHTML =
            "<td>" +
            item.name +
            "</td>" +
            "<td>" +
            item.email +
            "</td>" +
            `<td><button type='button' class='btn btn-outline-danger' onclick =DeleteFunction(${item.Id})  >Delete</button></td>`;
          tbody.appendChild(row);
        }
      }
      function DeleteFunction(id) {
        jsonData = jsonData.filter((item) => item.Id !== id);
        localStorage.setItem("data", JSON.stringify(jsonData));
        var JsonDataFromLocalStorage = JSON.parse(
          window.localStorage.getItem("data")
        );
        RenderDataintoTable(JsonDataFromLocalStorage);
      }
    </script>
  </head>
  <body>
    <form>
      <div class="container mt-5">
        <div class="row">
          <div class="col-md-6 offset-md-3">
            <h1 class="mb-4">Profile Update Form</h1>

            <div class="form-group">
              <label for="name">Name:</label>
              <input
                type="text"
                class="form-control"
                id="name"
                name="name"
                placeholder="Enter your Name"
              />
            </div>

            <label for="exampleDataList" class="form-label"
              >Department Name</label
            >
            <input
              class="form-control"
              list="datalistOptions"
              id="exampleDataList"
              placeholder="Type to search..."
            />
            <datalist id="datalistOptions">
              <option value="CSE"></option>
              <option value="Mech"></option>
              <option value="EEE"></option>
              <option value="ECE"></option>
              <option value="IT"></option>
            </datalist>

            <div class="form-group">
              <label for="email">Email:</label>
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                placeholder="Enter your email"
              />
            </div>

            <div class="form-group">
              <label for="password">Password:</label>
              <input
                type="password"
                class="form-control"
                id="password"
                name="password"
                placeholder="Enter your password"
              />
            </div>

            <div class="form-group">
              <label for="message">Message:</label>
              <textarea
                class="form-control"
                id="message"
                name="message"
                rows="3"
                placeholder="Enter your message"
              ></textarea>
            </div>

            <div class="form-group">
              <label for="gender">Gender:</label>
              <select class="form-control" id="gender" name="gender">
                <option value="">Select your gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="col-12" id="submitmessage">
              <button type="submit" class="btn btn-primary mb-2">Submit</button>
              <div id="After-Submit-message"></div>
            </div>
          </div>
        </div>
      </div>
    </form>
    <div id="tableid "></div>
    <table class="table table-success table-striped">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Email-Id</th>
          <th scope="col">Delete</th>
        </tr>
      </thead>
      <tbody id="tablebody"></tbody>
    </table>
  </body>
</html>
